<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sharing Numbers - Math Club</title>
  <link rel="stylesheet" href="../styles.css">
  <style>


    /* ---- Game card ---- */
    .game-card {
      background: white;
      border-radius: 16px;
      padding: 2.5rem 2rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      text-align: center;
      max-width: 520px;
      margin: 0 auto;
    }

    /* ---- Score display ---- */
    .score-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      font-size: 1.05rem;
      color: #64748b;
    }

    .score-bar .score-value {
      font-weight: 700;
      color: #4c6ef5;
      font-size: 1.2rem;
    }

    .score-bar .round-value {
      font-weight: 600;
      color: #7c3aed;
    }

    .score-bar .high-score-value {
      font-weight: 700;
      color: #f59e0b;
    }

    /* ---- Number bubble ---- */
    .number-bubble {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 1rem auto 1.5rem;
      font-size: 3rem;
      font-weight: 800;
      color: white;
      background: linear-gradient(135deg, #7c3aed, #4c6ef5);
      background-size: 200% 200%;
      animation: bubblePulse 3s ease-in-out infinite;
      box-shadow: 0 6px 24px rgba(124, 58, 237, 0.3);
    }

    @keyframes bubblePulse {
      0%, 100% { background-position: 0% 50%; transform: scale(1); box-shadow: 0 6px 24px rgba(124, 58, 237, 0.3); }
      50%      { background-position: 100% 50%; transform: scale(1.12); box-shadow: 0 10px 36px rgba(124, 58, 237, 0.45); }
    }

    .prompt-text {
      font-size: 1.2rem;
      color: #475569;
      margin-bottom: 1.5rem;
      text-wrap: balance;
    }

    /* ---- Choice buttons ---- */
    .choices {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      border: none;
      border-radius: 12px;
      padding: 0.85rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      color: white;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.15);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-sharable {
      background: linear-gradient(135deg, #10b981, #34d399);
    }

    .btn-not-sharable {
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
    }

    .btn-again {
      background: linear-gradient(135deg, #7c3aed, #4c6ef5);
      margin-top: 1.5rem;
    }

    /* ---- Feedback states ---- */
    .feedback {
      display: none;
      margin-top: 1rem;
    }

    .feedback.visible {
      display: block;
    }

    .feedback-correct {
      color: #059669;
      font-size: 1.3rem;
      font-weight: 700;
      animation: popIn 0.35s ease;
    }

    .feedback-wrong {
      animation: popIn 0.35s ease;
    }

    .feedback-wrong .wrong-label {
      color: #dc2626;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
    }

    .feedback-wrong .explanation {
      background: #fef3c7;
      border-radius: 10px;
      padding: 1rem 1.25rem;
      font-size: 1.05rem;
      color: #92400e;
      line-height: 1.5;
      margin-bottom: 0.5rem;
    }

    .final-score {
      font-size: 1.1rem;
      color: #64748b;
      margin-top: 0.75rem;
    }

    .btn-next {
      background: linear-gradient(135deg, #10b981, #34d399);
      margin-top: 1rem;
    }

    @keyframes popIn {
      0%   { opacity: 0; transform: scale(0.8); }
      100% { opacity: 1; transform: scale(1); }
    }

    /* ---- Celebration burst ---- */
    .celebration {
      pointer-events: none;
      position: absolute;
      inset: 0;
      overflow: hidden;
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 2px;
      opacity: 0;
    }

    @keyframes confettiFall {
      0%   { opacity: 1; transform: translateY(0) rotate(0deg); }
      100% { opacity: 0; transform: translateY(120px) rotate(360deg); }
    }

    /* ---- Container needs relative for celebration overlay ---- */
    .game-wrapper {
      position: relative;
    }
  </style>
</head>
<body>
  <header>
    <h1>Math Club</h1>
  </header>

  <main>
    <div class="back-row">
      <a href="../index.html" class="back-btn" aria-label="Back to Activities"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 10H5M5 10l5-5M5 10l5 5"/></svg></a>
    </div>

    <div class="game-wrapper">
      <div class="game-card">
        <h2 class="activity-title">Sharing Numbers</h2>
        <div class="score-bar">
          <span>Round: <span class="round-value" id="round">1</span></span>
          <span>Best: <span class="high-score-value" id="high-score">0</span></span>
          <span>Score: <span class="score-value" id="score">0</span></span>
        </div>

        <div id="game-area">
          <div class="number-bubble" id="number-bubble">4</div>
          <p class="prompt-text">Can this number be shared equally in more than one way?</p>

          <div class="choices" id="choices">
            <button class="btn btn-sharable" onclick="event.stopPropagation(); answer(true)">Sharable!</button>
            <button class="btn btn-not-sharable" onclick="event.stopPropagation(); answer(false)">Not Sharable!</button>
          </div>

          <div class="feedback" id="feedback-correct">
            <p class="feedback-correct" id="correct-msg"></p>
            <button class="btn btn-next" onclick="event.stopPropagation(); goNextRound()">Next Round</button>
          </div>

          <div class="feedback feedback-wrong" id="feedback-wrong">
            <p class="wrong-label" id="wrong-label"></p>
            <div class="explanation" id="explanation"></div>
            <p class="final-score" id="final-score"></p>
            <button class="btn btn-again" onclick="resetGame()">Play Again</button>
          </div>
        </div>
      </div>

      <div class="celebration" id="celebration"></div>
    </div>
  </main>

<script>
  let score = 0;
  let round = 1;
  let currentNumber = 0;
  let awaitingNext = false;
  let highScore = parseInt(localStorage.getItem("sharingNumbers_highScore")) || 0;

  const numberBubble = document.getElementById("number-bubble");
  const scoreEl = document.getElementById("score");
  const roundEl = document.getElementById("round");
  const highScoreEl = document.getElementById("high-score");
  const choicesEl = document.getElementById("choices");
  const feedbackCorrect = document.getElementById("feedback-correct");
  const correctMsg = document.getElementById("correct-msg");
  const feedbackWrong = document.getElementById("feedback-wrong");
  const wrongLabel = document.getElementById("wrong-label");
  const explanationEl = document.getElementById("explanation");
  const finalScoreEl = document.getElementById("final-score");
  const celebration = document.getElementById("celebration");

  function isComposite(n) {
    if (n < 4) return false;
    for (let i = 2; i <= Math.sqrt(n); i++) {
      if (n % i === 0) return true;
    }
    return false;
  }

  function getFactorPair(n) {
    for (let i = 2; i <= Math.sqrt(n); i++) {
      if (n % i === 0) return [i, n / i];
    }
    return [1, n];
  }

  function getRange() {
    if (score < 5)  return { min: 5,  max: 12 };
    if (score < 10) return { min: 10, max: 25 };
    if (score < 15) return { min: 20, max: 50 };
    if (score < 30) return { min: 30, max: 100 };
    return { min: 100, max: 999 };
  }

  function pickNumber() {
    const { min, max } = getRange();
    const superHard = score >= 30;
    const hard = score >= 15;
    const tricky = [1, 3, 7, 9];
    let n;
    do {
      if (superHard) {
        const base = Math.floor(Math.random() * 90 + 10) * 10;
        n = base + tricky[Math.floor(Math.random() * tricky.length)];
      } else {
        n = Math.floor(Math.random() * (max - min + 1)) + min;
        if (hard && Math.random() < 0.7) {
          const base = Math.floor(n / 10) * 10;
          n = base + tricky[Math.floor(Math.random() * tricky.length)];
          if (n < min) n += 10;
          if (n > max) n -= 10;
        }
      }
    } while (n === currentNumber);
    return n;
  }

  function nextRound() {
    currentNumber = pickNumber();
    numberBubble.textContent = currentNumber;
    roundEl.textContent = round;
    scoreEl.textContent = score;
    choicesEl.style.display = "flex";
    feedbackCorrect.classList.remove("visible");
    feedbackWrong.classList.remove("visible");
    awaitingNext = false;

    // Re-trigger bubble animation
    numberBubble.style.animation = "none";
    numberBubble.offsetHeight; // force reflow
    numberBubble.style.animation = "";
  }

  function showConfetti() {
    celebration.innerHTML = "";
    const colors = ["#7c3aed", "#4c6ef5", "#10b981", "#f59e0b", "#ec4899", "#34d399"];
    for (let i = 0; i < 20; i++) {
      const dot = document.createElement("div");
      dot.className = "confetti";
      dot.style.left = Math.random() * 100 + "%";
      dot.style.top = Math.random() * 40 + "%";
      dot.style.background = colors[Math.floor(Math.random() * colors.length)];
      dot.style.animation = `confettiFall 0.8s ${Math.random() * 0.3}s ease-out forwards`;
      celebration.appendChild(dot);
    }
  }

  function answer(saidShareable) {
    if (awaitingNext) return;

    const composite = isComposite(currentNumber);
    const correct = saidShareable === composite;

    if (correct) {
      awaitingNext = true;
      score++;
      scoreEl.textContent = score;
      choicesEl.style.display = "none";

      if (composite) {
        const [a, b] = getFactorPair(currentNumber);
        correctMsg.textContent = `Yes! ${a} pieces each for ${b} people!`;
      } else {
        correctMsg.textContent = `Correct! It's not sharable!`;
      }

      feedbackCorrect.classList.add("visible");
      showConfetti();
    } else {
      awaitingNext = true;
      choicesEl.style.display = "none";

      if (composite) {
        const [a, b] = getFactorPair(currentNumber);
        wrongLabel.textContent = "Not quite!";
        explanationEl.textContent =
          `It is sharable! ${a} pieces each for ${b} people.`;
      } else {
        wrongLabel.textContent = "Not quite!";
        explanationEl.textContent =
          `It is not sharable â€” no way to split it into equal groups.`;
      }

      if (score > highScore) {
        highScore = score;
        localStorage.setItem("sharingNumbers_highScore", highScore);
        highScoreEl.textContent = highScore;
        finalScoreEl.textContent = `New best: ${score} point${score !== 1 ? "s" : ""}!`;
      } else {
        finalScoreEl.textContent = `You scored ${score} point${score !== 1 ? "s" : ""}!`;
      }
      feedbackWrong.classList.add("visible");
    }
  }

  function goNextRound() {
    if (!awaitingNext) return;
    round++;
    nextRound();
  }

  function resetGame() {
    score = 0;
    round = 1;
    nextRound();
  }

  // Start
  highScoreEl.textContent = highScore;
  nextRound();
</script>
</body>
</html>
